
&НаКлиенте
Процедура ОК(Команда)
	ВозвратПароль = Пароль;
	
	Если ПустаяСтрока(Пароль) И НЕ ПустаяСтрока(Элементы.Пароль.ТекстРедактирования) Тогда
		ВозвратПароль = Элементы.Пароль.ТекстРедактирования;
	КонецЕсли;	
	
	СтруктураВозврата = Новый Структура("Пароль, СохранятьСРасшифровкой, РасширениеДляЗашифрованныхФайлов", 
		ВозвратПароль, СохранятьСРасшифровкой, РасширениеДляЗашифрованныхФайлов);
	Закрыть(СтруктураВозврата);
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Пропускаем инициализацию, чтобы гарантировать получение формы при передаче параметра "АвтоТест".
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;
	
	СохранятьСРасшифровкой = 1;
	Заголовок = Параметры.Заголовок;
	
	Если Параметры.Свойство("ПредставленияСертификатов") Тогда
		ПредставленияСертификатов = Параметры.ПредставленияСертификатов;
	Иначе
		Элементы.ПредставленияСертификатов.Видимость = Ложь;
	КонецЕсли;
	
	РасширениеДляЗашифрованныхФайлов = ОбщегоНазначения.ХранилищеОбщихНастроекЗагрузить("ЭЦП", "РасширениеДляЗашифрованныхФайлов");
	Если ПустаяСтрока(РасширениеДляЗашифрованныхФайлов) Тогда
		РасширениеДляЗашифрованныхФайлов = "p7m";
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СохранятьСРасшифровкойПриИзменении(Элемент)
	Элементы.Пароль.Доступность = (СохранятьСРасшифровкой = 1);
КонецПроцедуры
